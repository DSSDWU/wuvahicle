<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบขึ้นทะเบียนขอใช้รถ ม.วลัยลักษณ์</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SweetAlert2 for notifications -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fafc; /* Light slate background */
        }
        .form-section {
            background-color: white;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            overflow: hidden;
        }
        .form-section-header {
            background-color: #ecfdf5; /* Lighter green */
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #d1fae5;
        }
        .form-section-title {
            font-size: 1.125rem; /* 18px */
            font-weight: 700;
            color: #065f46; /* Darker green */
        }
        .form-label {
            font-weight: 500;
            color: #374151; /* Gray 700 */
        }
        .form-input, .form-select {
            border-radius: 0.5rem; /* 8px */
            border: 1px solid #d1d5db; /* Gray 300 */
            background-color: #f9fafb; /* Gray 50 */
            transition: all 0.2s ease-in-out;
        }
        .form-input:focus, .form-select:focus {
            border-color: #10b981; /* Emerald 500 */
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
            outline: none;
        }
        .submit-btn {
            background-image: linear-gradient(to right, #10b981, #059669);
            color: white;
            font-weight: 700;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .submit-btn:disabled {
            background-image: none;
            background-color: #d1d5db;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .preview-container {
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio */
            position: relative;
            border-radius: 0.5rem;
            border: 2px dashed #d1d5db;
            transition: all 0.2s ease-in-out;
        }
        .preview-container:hover {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        .preview-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.5rem;
        }
        .preview-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #6b7280;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        <header class="text-center mb-8">
            <img src="https://www.wu.ac.th/uploads/logoWU_1631668089.png" alt="Walailak University Logo" class="mx-auto h-20 w-auto mb-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-green-900">ระบบขึ้นทะเบียนขอใช้รถ</h1>
            <p class="text-gray-600 mt-1">มหาวิทยาลัยวลัยลักษณ์</p>
        </header>

        <form id="vehicleForm" class="space-y-8">
            
            <!-- ส่วนที่ 1: ข้อมูลส่วนตัว -->
            <div class="form-section">
                <div class="form-section-header">
                    <h2 class="form-section-title">ส่วนที่ 1: ข้อมูลส่วนตัว</h2>
                </div>
                <div class="p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
                    <div>
                        <label for="studentId" class="block text-sm form-label mb-1">รหัสนักศึกษา <span class="text-red-500">*</span></label>
                        <input type="text" id="studentId" name="studentId" class="block w-full form-input" placeholder="ตัวเลข 8 หลัก" required maxlength="8">
                        <p id="studentIdError" class="text-red-500 text-xs mt-1 hidden">กรุณากรอกรหัสนักศึกษาเป็นตัวเลข 8 หลัก</p>
                    </div>
                    <div>
                        <label for="fullName" class="block text-sm form-label mb-1">ชื่อ-สกุล <span class="text-red-500">*</span></label>
                        <input type="text" id="fullName" name="fullName" class="block w-full form-input" required>
                    </div>
                    <div>
                        <label for="faculty" class="block text-sm form-label mb-1">สำนักวิชา <span class="text-red-500">*</span></label>
                        <select id="faculty" name="faculty" class="block w-full form-select" required>
                            <option value="" disabled selected>-- กรุณาเลือก --</option>
                        </select>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm form-label mb-1">เบอร์โทรศัพท์ <span class="text-red-500">*</span></label>
                        <input type="tel" id="phone" name="phone" class="block w-full form-input" placeholder="08xxxxxxxx" required maxlength="10">
                        <p id="phoneError" class="text-red-500 text-xs mt-1 hidden">รูปแบบไม่ถูกต้อง (ต้องเป็นตัวเลข 10 หลัก และขึ้นต้นด้วย 0)</p>
                    </div>
                    <div>
                        <label for="residenceType" class="block text-sm form-label mb-1">ที่พักปัจจุบัน <span class="text-red-500">*</span></label>
                        <select id="residenceType" name="residenceType" class="block w-full form-select" required>
                            <option value="" disabled selected>-- กรุณาเลือก --</option>
                            <option value="หอพักภายในมหาวิทยาลัย">หอพักภายในมหาวิทยาลัย</option>
                            <option value="หอพักภายนอกมหาวิทยาลัย">หอพักภายนอกมหาวิทยาลัย</option>
                            <option value="บ้านตนเอง">บ้านตนเอง</option>
                        </select>
                    </div>
                    <div>
                        <label for="address" class="block text-sm form-label mb-1">ชื่อหอพัก/ห้อง/บ้านเลขที่ <span class="text-red-500">*</span></label>
                        <input type="text" id="address" name="address" class="block w-full form-input" required>
                        <p class="text-xs text-gray-500 mt-1">กรณีหอพัก ให้กรอกชื่อหอพักและหมายเลขห้อง / กรณีบ้านพัก ให้กรอกบ้านเลขที่และที่อยู่</p>
                    </div>
                    <div>
                        <label for="emergencyContactName" class="block text-sm form-label mb-1">ผู้ติดต่อกรณีฉุกเฉิน <span class="text-red-500">*</span></label>
                        <input type="text" id="emergencyContactName" name="emergencyContactName" class="block w-full form-input" required>
                    </div>
                    <div>
                        <label for="emergencyRelationship" class="block text-sm form-label mb-1">ความสัมพันธ์กับนักศึกษา <span class="text-red-500">*</span></label>
                        <select id="emergencyRelationship" name="emergencyRelationship" class="block w-full form-select" required>
                             <option value="" disabled selected>-- กรุณาเลือก --</option>
                             <option value="บิดา/มารดา">บิดา/มารดา</option>
                             <option value="ผู้ปกครอง">ผู้ปกครอง</option>
                             <option value="ญาติ">ญาติ</option>
                             <option value="เพื่อน">เพื่อน</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label for="emergencyPhone" class="block text-sm form-label mb-1">เบอร์โทรศัพท์ผู้ติดต่อกรณีฉุกเฉิน <span class="text-red-500">*</span></label>
                        <input type="tel" id="emergencyPhone" name="emergencyPhone" class="block w-full form-input" placeholder="08xxxxxxxx" required maxlength="10">
                         <p id="emergencyPhoneError" class="text-red-500 text-xs mt-1 hidden">รูปแบบไม่ถูกต้อง (ต้องเป็นตัวเลข 10 หลัก และขึ้นต้นด้วย 0)</p>
                    </div>
                     <div class="md:col-span-2">
                        <label for="drivingLicense" class="block text-sm form-label mb-1">ใบอนุญาตขับรถ <span class="text-red-500">*</span></label>
                        <select id="drivingLicense" name="drivingLicense" class="block w-full form-select" required>
                            <option value="" disabled selected>-- กรุณาเลือก --</option>
                            <option value="ไม่มีใบอนุญาตขับรถที่ขอขึ้นทะเบียน">ไม่มีใบอนุญาตขับรถที่ขอขึ้นทะเบียน</option>
                            <option value="มีใบอนุญาตขับรถที่ขอขึ้นทะเบียนแล้ว">มีใบอนุญาตขับรถที่ขอขึ้นทะเบียนแล้ว</option>
                            <option value="รถที่ขอขึ้นทะเบียนเป็นจักรยานไฟฟ้า">รถที่ขอขึ้นทะเบียนเป็นจักรยานไฟฟ้า</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ส่วนที่ 2: ข้อมูลรถ -->
            <div class="form-section">
                <div class="form-section-header">
                    <h2 class="form-section-title">ส่วนที่ 2: ข้อมูลรถที่ขึ้นทะเบียน</h2>
                </div>
                <div class="p-6 sm:p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
                        <div>
                            <label for="vehicleType" class="block text-sm form-label mb-1">ประเภทรถ <span class="text-red-500">*</span></label>
                            <select id="vehicleType" name="vehicleType" class="block w-full form-select" required>
                                <option value="" disabled selected>-- กรุณาเลือก --</option>
                                <option value="รถยนต์(น้ำมัน)">รถยนต์(น้ำมัน)</option>
                                <option value="รถยนต์ไฟฟ้า">รถยนต์ไฟฟ้า</option>
                                <option value="รถจักรยานยนต์ไฟฟ้า">รถจักรยานยนต์ไฟฟ้า</option>
                                <option value="รถจักรยานไฟฟ้า">รถจักรยานไฟฟ้า</option>
                            </select>
                        </div>
                         <div>
                            <label for="vehicleColor" class="block text-sm form-label mb-1">สีรถ <span class="text-red-500">*</span></label>
                            <input type="text" id="vehicleColor" name="vehicleColor" class="block w-full form-input" required>
                             <p class="text-xs text-gray-500 mt-1">สีตามคู่มือรถหรือตอบสีที่สามารถเห็นได้ชัดเจนที่สุด 2 สี</p>
                        </div>
                        <div>
                            <label for="vehicleBrand" class="block text-sm form-label mb-1">ยี่ห้อรถ <span class="text-red-500">*</span></label>
                            <input type="text" id="vehicleBrand" name="vehicleBrand" class="block w-full form-input" required>
                        </div>
                        <div>
                            <label for="vehicleModel" class="block text-sm form-label mb-1">รุ่นรถ <span class="text-red-500">*</span></label>
                            <input type="text" id="vehicleModel" name="vehicleModel" class="block w-full form-input" required>
                        </div>
                        <div>
                            <label for="licensePlate" class="block text-sm form-label mb-1">ทะเบียนรถ <span class="text-red-500">*</span></label>
                            <input type="text" id="licensePlate" name="licensePlate" class="block w-full form-input" required>
                            <p class="text-xs text-gray-500 mt-1">กรณีป้ายแดงให้กรอก “ป้ายแดง” / รถที่จดทะเบียนไม่ได้ให้กรอก “ไม่สามารถจดทะเบียนได้”</p>
                        </div>
                        <div>
                            <label for="province" class="block text-sm form-label mb-1">จังหวัด <span class="text-red-500">*</span></label>
                            <select id="province" name="province" class="block w-full form-select" required>
                                <option value="" disabled selected>-- กรุณาเลือก --</option>
                                 <option value="ป้ายแดง">ป้ายแดง</option>
                                 <option value="ไม่สามารถจดทะเบียนได้">ไม่สามารถจดทะเบียนได้</option>
                            </select>
                        </div>
                    </div>

                    <!-- File Uploads -->
                    <div class="mt-8">
                         <label class="block text-sm form-label mb-2">รูปถ่ายรถ (ไฟล์ภาพขนาดไม่เกิน 10MB) <span class="text-red-500">*</span></label>
                         <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <!-- Helper function creates these blocks -->
                         </div>
                    </div>
                </div>
            </div>

            <!-- Confirmation & Submit -->
            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex items-start">
                    <div class="flex items-center h-5">
                        <input id="confirmation" name="confirmation" type="checkbox" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 rounded" required>
                    </div>
                    <div class="ml-3 text-sm">
                        <label for="confirmation" class="font-medium text-gray-700">ขอรับรองว่าข้อมูลถูกต้องและเป็นความจริงทุกประการ หากมีเจตนาให้ข้อมูลเท็จ ข้าพเจ้ายินดีรับโทษตามระเบียบและข้อบังคับของมหาวิทยาลัยทุกประการ <span class="text-red-500">*</span></label>
                    </div>
                </div>
                 <div class="text-center mt-8">
                    <button type="submit" id="submitBtn" class="submit-btn" disabled>ส่งข้อมูล</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        // --- START OF CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxh12czKMWmDaV839JzY7pu9cWbTN_ARSHU3-RY4by-FGOiBGKhQHtbyBokzHQcUpxf1w/exec";
        // --- END OF CONFIGURATION ---

        // --- DATA FOR DROPDOWNS ---
        const faculties = ["การจัดการ", "การบัญชีและการเงิน", "เทคโนโลยีการเกษตรและอุตสาหกรรมอาหาร", "นิติศาสตร์", "พยาบาลศาสตร์", "แพทยศาสตร์", "เภสัชศาสตร์", "รัฐศาสตร์และรัฐประศาสนศาสตร์", "วิทยาศาสตร์", "วิศวกรรมศาสตร์และเทคโนโลยี", "ศึกษาศาสตร์", "ศิลปศาสตร์", "สถาปัตยกรรมศาสตร์และการออกแบบ", "สหเวชศาสตร์", "สาธารณสุขศาสตร์", "สารสนเทศศาสตร์", "วิทยาลัยทันตแพทยศาสตร์นานาชาติ", "วิทยาลัยนานาชาติ", "วิทยาลัยสัตวแพทยศาสตร์อัครราชกุมารี"];
        const provinces = ["กรุงเทพมหานคร", "กระบี่", "กาญจนบุรี", "กาฬสินธุ์", "กำแพงเพชร", "ขอนแก่น", "จันทบุรี", "ฉะเชิงเทรา", "ชลบุรี", "ชัยนาท", "ชัยภูมิ", "ชุมพร", "เชียงราย", "เชียงใหม่", "ตรัง", "ตราด", "ตาก", "นครนายก", "นครปฐม", "นครพนม", "นครราชสีมา", "นครศรีธรรมราช", "นครสวรรค์", "นนทบุรี", "นราธิวาส", "น่าน", "บึงกาฬ", "บุรีรัมย์", "ปทุมธานี", "ประจวบคีรีขันธ์", "ปราจีนบุรี", "ปัตตานี", "พระนครศรีอยุธยา", "พะเยา", "พังงา", "พัทลุง", "พิจิตร", "พิษณุโลก", "เพชรบุรี", "เพชรบูรณ์", "แพร่", "ภูเก็ต", "มหาสารคาม", "มุกดาหาร", "แม่ฮ่องสอน", "ยโสธร", "ยะลา", "ร้อยเอ็ด", "ระนอง", "ระยอง", "ราชบุรี", "ลพบุรี", "ลำปาง", "ลำพูน", "เลย", "ศรีสะเกษ", "สกลนคร", "สงขลา", "สตูล", "สมุทรปราการ", "สมุทรสงคราม", "สมุทรสาคร", "สระแก้ว", "สระบุรี", "สิงห์บุรี", "สุโขทัย", "สุพรรณบุรี", "สุราษฎร์ธานี", "สุรินทร์", "หนองคาย", "หนองบัวลำภู", "อ่างทอง", "อำนาจเจริญ", "อุดรธานี", "อุตรดิตถ์", "อุทัยธานี", "อุบลราชธานี"];
        
        // --- DYNAMIC ELEMENT CREATION ---
        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.innerHTML = option;
                select.appendChild(opt);
            });
        }
        
        function createUploadSlot(id, name, label) {
            return `
                <div>
                    <label class="text-sm text-center block text-gray-600 mb-1">${label}</label>
                    <input type="file" id="${id}" name="${name}" class="hidden" accept="image/*" onchange="previewImage(event, 'preview${id}')" required>
                    <label for="${id}" class="cursor-pointer">
                        <div class="preview-container">
                             <div id="placeholder${id}" class="preview-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                <span class="text-xs mt-1">เลือกรูป</span>
                            </div>
                            <img id="preview${id}" class="preview-img hidden">
                        </div>
                    </label>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateSelect('faculty', faculties);
            populateSelect('province', provinces);

            const uploadContainer = document.querySelector('.form-section .grid.grid-cols-2');
            const uploadSlots = [
                { id: 'photoFront', name: 'photoFront', label: 'ด้านหน้า' },
                { id: 'photoRear', name: 'photoRear', label: 'ด้านหลัง' },
                { id: 'photoLeft', name: 'photoLeft', label: 'ด้านซ้าย' },
                { id: 'photoRight', name: 'photoRight', label: 'ด้านขวา' }
            ];
            uploadContainer.innerHTML = uploadSlots.map(slot => createUploadSlot(slot.id, slot.name, slot.label)).join('');
        });

        // --- FORM ELEMENTS & VALIDATION ---
        const form = document.getElementById('vehicleForm');
        const submitBtn = document.getElementById('submitBtn');
        const confirmationCheckbox = document.getElementById('confirmation');
        
        const studentIdInput = document.getElementById('studentId');
        const phoneInput = document.getElementById('phone');
        const emergencyPhoneInput = document.getElementById('emergencyPhone');

        const studentIdError = document.getElementById('studentIdError');
        const phoneError = document.getElementById('phoneError');
        const emergencyPhoneError = document.getElementById('emergencyPhoneError');

        const validateStudentId = () => {
            const isValid = /^\d{8}$/.test(studentIdInput.value);
            studentIdError.classList.toggle('hidden', isValid || studentIdInput.value === '');
            return isValid;
        };
        const validatePhone = (input, errorElement) => {
            const isValid = /^0\d{9}$/.test(input.value);
            errorElement.classList.toggle('hidden', isValid || input.value === '');
            return isValid;
        };
        
        studentIdInput.addEventListener('input', validateStudentId);
        phoneInput.addEventListener('input', () => validatePhone(phoneInput, phoneError));
        emergencyPhoneInput.addEventListener('input', () => validatePhone(emergencyPhoneInput, emergencyPhoneError));

        confirmationCheckbox.addEventListener('change', () => {
            submitBtn.disabled = !confirmationCheckbox.checked;
        });

        // --- IMAGE PREVIEW ---
        function previewImage(event, previewId) {
            const input = event.target;
            const reader = new FileReader();
            const preview = document.getElementById(previewId);
            const placeholder = document.getElementById(previewId.replace('preview', 'placeholder'));
            
            reader.onload = function(){
                if (reader.readyState == 2) {
                    preview.src = reader.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                }
            }
            
            const file = input.files[0];
            if (file) {
                if (file.size > 10 * 1024 * 1024) { // 10 MB validation
                    Swal.fire({ icon: 'error', title: 'ไฟล์ใหญ่เกินไป', text: 'กรุณาเลือกไฟล์ภาพที่มีขนาดไม่เกิน 10MB' });
                    input.value = '';
                    preview.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                    return;
                }
                reader.readAsDataURL(file);
            }
        }
        
        // --- FILE TO BASE64 CONVERTER ---
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                if (!file) {
                    resolve(null);
                    return;
                }
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // --- FORM SUBMISSION ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const isStudentIdValid = validateStudentId();
            const isPhoneValid = validatePhone(phoneInput, phoneError);
            const isEmergencyPhoneValid = validatePhone(emergencyPhoneInput, emergencyPhoneError);
            
            if (!form.checkValidity() || !isStudentIdValid || !isPhoneValid || !isEmergencyPhoneValid) {
                Swal.fire({ icon: 'error', title: 'ข้อมูลไม่ครบถ้วน', text: 'กรุณากรอกข้อมูลที่จำเป็น (*) ให้ครบถ้วนและถูกต้องตามรูปแบบ' });
                form.reportValidity();
                return;
            }

            Swal.fire({ title: 'กำลังบันทึกข้อมูล...', text: 'กรุณารอสักครู่', allowOutsideClick: false, didOpen: () => { Swal.showLoading() } });

            try {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                const [photoFront, photoRear, photoLeft, photoRight] = await Promise.all([
                    fileToBase64(document.getElementById('photoFront').files[0]),
                    fileToBase64(document.getElementById('photoRear').files[0]),
                    fileToBase64(document.getElementById('photoLeft').files[0]),
                    fileToBase64(document.getElementById('photoRight').files[0])
                ]);

                const submissionData = { ...data, photoFront, photoRear, photoLeft, photoRight };
                
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(submissionData),
                    redirect: 'follow'
                });

                Swal.fire({ icon: 'success', title: 'บันทึกข้อมูลสำเร็จ!', text: 'ข้อมูลของท่านถูกบันทึกเรียบร้อยแล้ว' });
                
                form.reset();
                document.querySelectorAll('.preview-img').forEach(img => img.classList.add('hidden'));
                document.querySelectorAll('.preview-placeholder').forEach(p => p.classList.remove('hidden'));
                submitBtn.disabled = true;

            } catch (error) {
                console.error('Error:', error);
                Swal.fire({ icon: 'error', title: 'เกิดข้อผิดพลาด', text: 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง' });
            }
        });
    </script>
</body>
</html>
